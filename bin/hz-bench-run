#!/usr/bin/env bash

set -e
cleanup() {
    exitCode=$?
    #aws-terminate a.box

    hz wipe

    jvmPids=$(jps -q | xargs pwdx | grep $(pwd) | awk '{print $1}' | sed s'/://')
    if [ -n "${jvmPids}" ] ; then
     echo ${jvmPids} | xargs kill -9
    fi

    echo "exitCode=${exitCode}"
    exit $exitCode
}
trap "cleanup" INT TERM EXIT

testDir=${1}
boxCount=${2}

subDir=$(date '+%Y_%m_%d-%H_%M_%S')
mkdir -p ${subDir}

cp a.box ${subDir}
cd ${subDir}
cp -r ${HZ_CMD_BENCH_SRC}/lab/${testDir}/* .

#hz-awsBox ${boxCount} a.box

./go | tee out.txt


