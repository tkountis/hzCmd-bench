#!/usr/bin/env bash


subDir="$(hazelcastVersion)/$(date '+%Y_%m_%d-%H_%M_%S')"
mkdir -p ${subDir}
cd ${subDir}

hz-bench-get hz

for i in $(find . -name go) ; do
  cd $(dirname $i)

    echo "10.212.1.101,10.212.40.101" >> a.box
    echo "10.212.1.102,10.212.40.102" >> a.box
    echo "10.212.1.103,10.212.40.103" >> a.box
    echo "10.212.1.104,10.212.40.104" >> a.box
    echo "10.212.1.105,10.212.40.105" >> a.box
    echo "10.212.1.106,10.212.40.106" >> a.box
    echo "10.212.1.108,10.212.40.108" >> a.box
    echo "10.212.1.109,10.212.40.109" >> a.box
    echo "10.212.1.110,10.212.40.110" >> a.box


    hz broker -ip 10.212.1.107
    ./go $(hazelcastVersion) M10C500 danny
    exitCode=$?

    hz wipe
    hz-killSubJava
    gcViewerPics &> /dev/null || true
    hz-viewGc > gc.html || true
  cd -

  if [[ ${exitCode} != 0 ]]; then
       echo "$(dirname $i) Failed" >> results.txt
  fi

done